
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The Joy of Joy - Language Perils</title>
  <meta name="author" content="Daniel Beskin">

  
  <meta name="description" content="Intro: [swap dip dup dip pop] dip dup dip pop
(sing aloud accompanied by a Jazz trio or even a cappella) Anyways, this is actual Joy source code, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ncreep.github.io/language_perils/blog/2013-03-18-the-joy-of-joy.html">
  <link href="/language_perils/favicon.png" rel="icon">
  <link href="/language_perils/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/language_perils/javascripts/modernizr.js"></script>
  <script src="/language_perils/javascripts/ender.js"></script>
  <script src="/language_perils/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/language_perils/atom.xml" rel="alternate" title="Language Perils" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39780832-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/language_perils/atom.xml" rel="subscribe-rss" title="subscribe via RSS"></a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ncreep.github.io/language_perils" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/language_perils/">
        <span class="site_title">
            Language Perils
        </span>
       
    </a></li>
  <li><a href="/language_perils/">Blog</a></li>
  <li><a href="/language_perils/blog/archives">Archives</a></li>
  <!-- <li><a href="/language_perils/about">About me</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">The Joy of Joy</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-18T06:21:00+02:00" pubdate data-updated="true">Mar 18<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><strong>Intro</strong>: <code>[swap  dip  dup  dip  pop]  dip  dup  dip  pop</code><br/>
(sing aloud accompanied by a Jazz trio or even <em>a cappella</em>)</p>

<p>Anyways, this is actual Joy source code, taken from the <a href="http://www.kevinalbrecht.com/code/joy-mirror/j02maf.html">Mathematical foundations of Joy</a> article. No, really, you&rsquo;re not squinting hard enough, there is some actual math there.</p>

<p>Well, this is my first language from the <a href="http://blog.fogus.me/2011/08/14/perlis-languages/">Perlis Languages</a> list.  It&rsquo;s a concatenative language, colloquially known as a stack-based language (not sure what sort of person goes all colloquial about anything concatenative, probably the sort of person that uses the word &ldquo;colloquial&rdquo;). Stack-based languages tend to have very little in the sense of syntax, one may even call them &ldquo;Lisp without the parentheses&rdquo;. So that makes Joy a good candidate to be the first language for this little project; it&rsquo;s rather simple and self-contained.  You can pretty much get all the material you might need to tackle Joy from the (mirror of) the <a href="http://www.kevinalbrecht.com/code/joy-mirror/joy.html">official site</a>. Other than that, as recommended by Fogus, there&rsquo;s the really nice &ldquo;<a href="http://www.codecommit.com/blog/category/cat">The Joy of Concatenative Languages</a>&rdquo; series by <a href="http://www.codecommit.com">Daniel Spiewak</a>; although his language of choice is Cat, it still is, as usual for Daniel&rsquo;s writings, a very instructive and fun read.</p>

<p>Let&rsquo;s take a quick tour of Joy, though for a proper introduction you should consult the <a href="http://www.kevinalbrecht.com/code/joy-mirror/j01tut.html">official one</a>.</p>

<!-- more -->


<p>To the eyes of a conventional programmer, the first thing that stands out in a stack-based language is the Reverse Polish notation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>3 4 + 5 *</span></code></pre></td></tr></table></div></figure>


<p>(Note that to actually evaluate the snippet in the Joy interpreter, you&rsquo;ll need to put a period at the end, as in <code>3 4 + 5 * .</code>, but I&rsquo;ll be omitting it here).</p>

<p>The above happens to be 35. And that obviously screams at you with the horrid unnaturalness of the out-of-order operators. Of course, the average programmer, being to some extent a form of a humanoid, expects this to be written infix as in:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>3 + 4 * 5</span></code></pre></td></tr></table></div></figure>


<p>Wait, that&rsquo;s actually 23. Of course I meant to write:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(3 + 4) * 5</span></code></pre></td></tr></table></div></figure>


<p>Now it&rsquo;s all natural and pleasing to the eye. And that&rsquo;s the last time in the Joy series that you&rsquo;ll be seeing anything written infix, get used to it, sorry&hellip;</p>

<p>Actually, there&rsquo;s a whole thing based around RPN having no precedence issues; it allows one to compose programs (functions) by just <em>concatenating</em> their sources &ndash; no need to worry about any missing parentheses. And that&rsquo;s why you call them <em>concatenative</em> languages; the stack is actually an optional implementation detail.<br/>
Having crossed the RPN chasm, we can continue to some Joy basics.</p>

<p>We&rsquo;ve already seen number literals and arithmetic operators. We also have the usual boolean values <code>true</code> and <code>false</code>; string literals are written in double quotes, and characters are prefixed with a single quote. So the following snippet yields <code>true</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"abcd" 1 at 'b equal</span></code></pre></td></tr></table></div></figure>


<p>Now I&rsquo;ll pretend that you know practically nothing about stacks and explain this snippet step by step. Having done that, I&rsquo;ll assume that by some miracle, you are now fluent in everything stack, and I wouldn&rsquo;t be bothered to give any more accounts of the source at such level of detail. Ready? Here we go:<br/>
The first word pushes <code>"abcd"</code> onto the stack; the second <code>1</code>. <code>at</code> looks at the last two things on the stack and treats the top one as a (zero based) index and the one below it as a string (or a list, we&rsquo;ll get to those in a bit). It then pops them off and leaves on top the character at the indexed position, in our case <code>'b</code>. Next we push another <code>'b</code> onto the top of the stack and test the equality of the top two items on the stack with <code>equal</code>, popping them off and pushing the result (<code>true</code>) onto the top.</p>

<p>Feeling fluent now? Great, moving on&hellip;</p>

<p>Next we have list literals, written in square brackets, so this yields 3:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1 2 3 4 5] 2 at</span></code></pre></td></tr></table></div></figure>


<p>Lists are heterogeneous and can contain anything, so this <code>[1 'c 2 "abc" [1 2 3] 5]</code> is a valid list.</p>

<p>Set literals can be written in curly brackets, as in <code>{1 2 3}</code>, but they can only contain &ldquo;small integers&rdquo;, so I didn&rsquo;t really have any use for them further down the road (too bad you can&rsquo;t plug in other implementations into this syntax, oh well&hellip;).</p>

<p>There is also a whole array of stack manipulation functions, such as swapping and duplicating items on the stack. So the following yields the square of 4:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>4 dup *  # =&gt; 16</span></code></pre></td></tr></table></div></figure>


<p>(The hash sign designates a comment)</p>

<p><strong>Interlude</strong>: <code>[[dup  dip  pop]  dip]  dip  swap  dip  dup  dip  pop</code></p>

<p>Now come the interesting bits &ndash; the lists introduced above are not plain lists, they are quoted programs (think Lisp lists). This means that the list <code>[4 dup *]</code> is actually a value representing the program above; it can be passed around and evaluated at will. Evaluation is accomplished via <em>combinators</em>. These take quoted programs as input and use them to calculate new values.<br/>
The simplest combinator is <code>i</code>; it just evaluates (unquotes) the quoted program at the top of the stack, like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[4 dup *] i # =&gt; 16</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s look at a slightly more interesting example. The combinator <code>map</code> takes a quoted program and applies it to the elements of a list:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1 2 3 4] [dup *] map # =&gt; [1 4 9 16]</span></code></pre></td></tr></table></div></figure>


<p>The above is one of the most common use cases for higher order functions, so we got that topic covered.</p>

<p>By now, you might&rsquo;ve noticed the conspicuous lack of control structures, guess what, these are also implemented with combinators. The standard <code>if then else</code> form looks like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1500 [1000 &gt;]  [2 /]  [3 *]  ifte  # =&gt; 750</span></code></pre></td></tr></table></div></figure>


<p>The first list is the condition, which is checked against the top of the stack (in this case 1500). If the condition is met, we apply the second quote to the top of the stack, otherwise the third.<br/>
It takes a little time to get used to this sort of syntax, but after you get it, there&rsquo;s a whole world of flexibility here&hellip;</p>

<p>The last type of combinators we&rsquo;ll look at are recursive combinators. These allow one to create recursive functions using anonymous recursion. The most basic recursive combinator is <code>linrec</code>, which performs linear recursion. The textbook example for linear recursion is the factorial, implementing it with <code>linrec</code> we get</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[null]  [succ]  [dup pred]  [*]  linrec</span></code></pre></td></tr></table></div></figure>


<p>The first quote is the <code>if</code> part, it checks for the base case (here, whether the current argument is 0). The second quote is the <code>then</code> part, which is executed when we reach the base case (here, when we reach 0, we take its successor, 1, and leave it on the stack). The last two quotes are the <code>else1</code> and <code>else2</code> parts. The first is executed before we take the recursive step; in here we duplicate the argument and take the predecessor of the copy. The second quote is executed after the recursion step, in this case we multiply the top two items on the stack. To sum up, we are recursively filling up the stack with the numbers from the given argument down to 1, then, when we back up, we are multiplying them in pairs leaving the result on top all the time, until we reach the original value. The last multiplication step gives us the value of the factorial at the top of the stack.</p>

<p>I found combinators to be my biggest stumbling block on the path to readability &ndash; when looking at a new combinator, you really haven&rsquo;t a chance of figuring out its purpose unless its name is very obvious or you have its documentation at hand. Take this for example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1]  [*]  primrec</span></code></pre></td></tr></table></div></figure>


<p>Can you guess what that function does? It happens to be the very same factorial function from before, implemented with a specialized version of <code>linrec</code>; it wasn&rsquo;t that obvious to me&hellip;<br/>
As you know, with great flexibility come great code obfuscation powers. But also, great DSL powers, and I really like DSLs, so overall, I&rsquo;m sure the whole combinators thing works out fine.</p>

<p>There are plenty more useful functions and combinators; you can see the whole standard library <a href="http://www.kevinalbrecht.com/code/joy-mirror/html-manual.html">here</a>.</p>

<p>The last bit of syntax I left out are definitions; you can actually give names to stuff in Joy. So if we wanted to name our square and factorial functions, we could do it like so:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DEFINE 
</span><span class='line'>   square == dup *;
</span><span class='line'>   factorial == [1]  [*]  primrec.</span></code></pre></td></tr></table></div></figure>


<p>And use it like so:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>4 square # =&gt; 16
</span><span class='line'>5 factorial # =&gt; 120</span></code></pre></td></tr></table></div></figure>


<p>There are also some modularization/information hiding facilities built in, but I won&rsquo;t be using them here, so moving right along.</p>

<p>This sums up my not so brief but definitely incomplete introduction to Joy. The most glaring thing I glossed over is the mathematical foundations of Joy. It so happens that Joy is a function-level programming language, in the sense that there are no values in the language, just functions. No, <code>42</code> is not a value, <code>42</code> is a function that takes a stack and returns a new stack with the value <code>42</code> on top. So without noticing it, all along we&rsquo;ve been composing functions and not just that &ndash; we&rsquo;ve been using point-free style while at it.<br/>
Although I didn&rsquo;t delve deep into the maths myself, its presence definitely makes me feel better. I like it when a language is well thought through; such elegance can only come from math.</p>

<p>All together now:<br/>
<strong>Outro</strong>: <code>[dup dip pop]  dip  dup  dip  pop</code></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Daniel Beskin</span></span>

      








  


<time datetime="2013-03-18T06:21:00+02:00" pubdate data-updated="true">Mar 18<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/language_perils/blog/categories/joy/'>Joy</a>, <a class='category' href='/language_perils/blog/categories/concatenative/'>concatenative</a>, <a class='category' href='/language_perils/blog/categories/stack-based/'>stack-based</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://ncreep.github.io/language_perils/blog/2013-03-18-the-joy-of-joy.html" data-via="" data-counturl="http://ncreep.github.io/language_perils/blog/2013-03-18-the-joy-of-joy.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/language_perils/blog/2013-03-18-introduction.html" title="Previous Post: Introduction">&laquo; Introduction</a>
      
      
        <a class="basic-alignment right" href="/language_perils/blog/2013-04-21-joyous-tree-friends.html" title="Next Post: Joyous Tree Friends">Joyous Tree Friends &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/language_perils/blog/2015-01-08-hello-frink.html">Hello Frink</a>
      </li>
    
      <li class="post">
        <a href="/language_perils/blog/2014-03-24-joy-no-more.html">Joy No More</a>
      </li>
    
      <li class="post">
        <a href="/language_perils/blog/2014-03-20-domain-specific-joy.html">Domain-specific Joy</a>
      </li>
    
      <li class="post">
        <a href="/language_perils/blog/2014-03-19-state-of-joy.html">State of Joy</a>
      </li>
    
      <li class="post">
        <a href="/language_perils/blog/2013-05-24-meta-joy.html">Meta-Joy</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Daniel Beskin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'langperils';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ncreep.github.io/language_perils/blog/2013-03-18-the-joy-of-joy.html';
        var disqus_url = 'http://ncreep.github.io/language_perils/blog/2013-03-18-the-joy-of-joy.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
